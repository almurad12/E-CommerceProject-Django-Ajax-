<div class="offcanvas offcanvas-end text-dark" tabindex="-1" id="addToCartSidebar" style="width: 300px; height: 90%;">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Shopping Cart</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>

    <div class="offcanvas-body">
        <div class="mb-3" data-bs-dismiss="offcanvas">
            <a href="#" class="text-decoration-none text-body">
                <i class="fas fa-long-arrow-alt-left me-2"></i>Continue shopping
            </a>
        </div>
        <hr>
        <div id="cart-container"></div> <!-- where items will be inserted -->

        <a href="{% url 'checkout' %}"
            class="btn btn-dark btn-md text-white btn-block d-flex justify-content-center">Place Order
        </a>

    </div>

</div>





<script>
    function loadCart() {
        $.ajax({
            url: "/cart/show/",  // your view that returns the JSON you shared
            type: "GET",
            success: function (response) {
                let cart = response.cart;
                let html = "";

                cart.items.forEach(item => {
                    html += `
                <div class="card mb-3 shadow-sm border-0 rounded-3">
                    <div class="card-body p-2">
                        <div class="d-flex align-items-center">
                            <!-- Product Image -->
                            <img src="${item.image_url}" 
                                 class="img-fluid rounded-3 border" 
                                 alt="${item.product_name}" 
                                 style="width: 65px; height: 65px; object-fit: cover;">
                
                            <!-- Product Details -->
                            <div class="ms-3 flex-grow-1">
                                <a href="/shop/${item.product_id}" 
                                   class="text-dark fw-bold text-decoration-none"
                                   onmouseover="this.style.textDecoration='underline'" 
                                   onmouseout="this.style.textDecoration='none'">
                                    ${item.product_name}
                                </a>
                                <br>
                                <small class="fw-bold">
                                    <span class="badge bg-primary">Variant: ${item.variant}</span>
                                </small>
                                <br>
                                <small class="text-bold">Quantity: ${item.quantity}</small>
                                <br>
                                <small class="text-bold">Price: ৳${item.price}</small>
                                <br>
                                <small class="fw-bold text-success">Total: ৳${item.product_total}</small>
                            </div>
                
                            <!-- Remove Button -->
                            <button class="btn btn-sm btn-outline-danger"
                                onclick="removeItem(${item.product_id}, ${item.image_id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>`;
                });

                // Append to container
                $("#cart-container").html(html);

                // Show totals
                $("#cart-container").append(`
                <div class="alert alert-info mt-3">
                    Subtotal: ৳${cart.total.subtotal} <br>
                    Delivery: ৳${cart.total.delivery_charge} <br>
                    <b>Grand Total: ৳${cart.total.grand_total}</b>
                </div>
            `);
            }
        });
    }
    // Delete item
    function removeItem(productId, imageId) {
            console.log("Removing product:", productId, "image:", imageId);

            if (isNaN(productId) || isNaN(imageId)) {
                console.error("Invalid product_id or image_id");
                return;
            }

            $.ajax({
                url: "/remove_from_cart/",
                type: "POST",
                data: {
                    product_id: productId,
                    image_id: imageId,
                    csrfmiddlewaretoken: "{{ csrf_token }}"
                },
                success: function (response) {
                    console.log("Removed:", response);
                    loadCart(); // refresh cart UI
                },
                error: function (xhr, status, error) {
                    console.error("Error removing:", error);
                }
            });
        }    
    // Load on page ready
    $(document).ready(function () {
        loadCart();
    });
</script>